Sergey Nikolenko's code; see individual files for comments.
